<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>ç§˜å¯†æ°£æ³¡åŒæ­¥ç‰ˆ - ä½ çš„å°ˆå±¬ç©ºé–“</title>
    <style>
        :root { --user-color: #00ffcc; }
        body { margin: 0; overflow: hidden; background: linear-gradient(to bottom, #000428, #004e92); font-family: sans-serif; }
        #top-bar { position: absolute; top: 20px; width: 100%; display: flex; justify-content: space-between; padding: 0 30px; box-sizing: border-box; z-index: 100; }
        .icon-btn { background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 10px 15px; border-radius: 50px; cursor: pointer; backdrop-filter: blur(5px); transition: 0.3s; }
        .icon-btn:hover { background: rgba(255,255,255,0.2); }
        #input-area { position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%); width: 80%; max-width: 500px; display: flex; gap: 10px; z-index: 100; }
        input[type="text"] { flex: 1; padding: 12px 20px; border-radius: 25px; border: none; background: rgba(255,255,255,0.9); outline: none; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        #send-btn { background: var(--user-color); color: #000; font-weight: bold; border: none; padding: 0 25px; border-radius: 25px; cursor: pointer; }
        .panel { position: absolute; top: 80px; background: rgba(10, 10, 10, 0.9); border: 1px solid #444; border-radius: 15px; padding: 20px; display: none; color: white; max-height: 70vh; overflow-y: auto; width: 280px; z-index: 200; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        #history-panel { left: 20px; }
        #settings-panel { right: 20px; }
        .history-item { border-bottom: 1px solid #333; padding: 10px 0; font-size: 0.9em; line-height: 1.4; }
        canvas { display: block; }
    </style>
</head>
<body>

<div id="top-bar">
    <button class="icon-btn" onclick="togglePanel('history-panel')">ğŸ“… ç§˜å¯†æ—¥èªŒ</button>
    <button class="icon-btn" onclick="togglePanel('settings-panel')">âš™ï¸ è¨­å®š</button>
</div>

<div id="history-panel" class="panel">
    <h3>æ­·å²ç´€éŒ„</h3>
    <div id="history-list">å°šæœªæ”¶åˆ°ç§˜å¯†...</div>
</div>

<div id="settings-panel" class="panel">
    <h3>å€‹äººè¨­å®š</h3>
    <label>é¸æ“‡ä½ çš„å°ˆå±¬æ°£æ³¡é¡è‰²ï¼š</label>
    <input type="color" id="color-picker" onchange="updateUserColor(this.value)" style="width:100%; height:40px; margin-top:10px; cursor:pointer;">
</div>

<div id="input-area">
    <input type="text" id="secret-input" placeholder="è®“å¿ƒäº‹åŒ–ä½œæ°£æ³¡å‡èµ·..." maxlength="50">
    <button id="send-btn" onclick="sendSecret()">ç™¼é€</button>
</div>

<canvas id="canvas"></canvas>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, push, onChildAdded, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    // é€™æ˜¯ä½ çš„å°ˆå±¬ Config
    const firebaseConfig = {
        apiKey: "AIzaSyBqeC1nFpEEuTcux022t0kaKDUgV3dY1i4",
        authDomain: "bubble-502a8.firebaseapp.com",
        databaseURL: "https://bubble-502a8-default-rtdb.firebaseio.com", 
        projectId: "bubble-502a8",
        storageBucket: "bubble-502a8.firebasestorage.app",
        messagingSenderId: "448571231354",
        appId: "1:448571231354:web:b70d4011ec6aa8e0737fc3",
        measurementId: "G-GQWGDELSJX"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const secretsRef = ref(db, 'secrets');

    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    let bubbles = [];
    let userColor = localStorage.getItem('userColor') || '#00ffcc';
    document.documentElement.style.setProperty('--user-color', userColor);
    document.getElementById('color-picker').value = userColor;

    class Bubble {
        constructor(text, color) {
            this.text = text;
            this.color = color;
            this.radius = Math.max(45, text.length * 8 + 15);
            this.x = Math.random() * (canvas.width - 100) + 50;
            this.y = canvas.height + 100;
            this.speed = 0.8 + Math.random() * 1.5;
            this.angle = Math.random() * Math.PI * 2;
            this.opacity = 1;
        }
        update() {
            this.y -= this.speed;
            this.angle += 0.02;
            this.currentX = this.x + Math.sin(this.angle) * 30;
            if (this.y < 50) this.opacity -= 0.005;
        }
        draw() {
            ctx.save();
            ctx.globalAlpha = Math.max(0, this.opacity);
            ctx.beginPath();
            ctx.arc(this.currentX, this.y, this.radius, 0, Math.PI * 2);
            let grad = ctx.createRadialGradient(this.currentX-10, this.y-10, 0, this.currentX, this.y, this.radius);
            grad.addColorStop(0, 'white');
            grad.addColorStop(0.3, this.color);
            grad.addColorStop(1, 'rgba(0,0,0,0.1)');
            ctx.fillStyle = grad;
            ctx.fill();
            ctx.strokeStyle = "rgba(255,255,255,0.4)";
            ctx.stroke();
            ctx.fillStyle = "white";
            ctx.font = "bold 16px sans-serif";
            ctx.textAlign = "center";
            ctx.fillText(this.text, this.currentX, this.y + 7);
            ctx.restore();
        }
    }

    window.sendSecret = function() {
        const input = document.getElementById('secret-input');
        if (!input.value.trim()) return;
        push(secretsRef, {
            text: input.value,
            color: userColor,
            time: serverTimestamp()
        });
        input.value = '';
    };

    onChildAdded(secretsRef, (snapshot) => {
        const data = snapshot.val();
        bubbles.push(new Bubble(data.text, data.color));
        const list = document.getElementById('history-list');
        if(list.innerText === "å°šæœªæ”¶åˆ°ç§˜å¯†...") list.innerText = "";
        const div = document.createElement('div');
        div.className = 'history-item';
        div.innerHTML = `<span style="color:${data.color}">â—</span> ${data.text}`;
        list.prepend(div);
    });

    window.togglePanel = (id) => {
        const el = document.getElementById(id);
        el.style.display = el.style.display === 'block' ? 'none' : 'block';
    };

    window.updateUserColor = (val) => {
        userColor = val;
        localStorage.setItem('userColor', val);
        document.documentElement.style.setProperty('--user-color', val);
    };

    function animate() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        bubbles = bubbles.filter(b => b.opacity > 0);
        bubbles.forEach(b => { b.update(); b.draw(); });
        requestAnimationFrame(animate);
    }

    window.addEventListener('resize', () => {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    });
    window.dispatchEvent(new Event('resize'));
    animate();
</script>
</body>
</html>
